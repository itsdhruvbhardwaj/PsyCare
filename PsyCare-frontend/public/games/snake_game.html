<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Snake Game</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    body {
        background-image: url('../../src/assets/music_bg.jpg'); /* Update path if needed */
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        font-family: 'Poppins', sans-serif;
        margin: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        color: #ffffff;
        user-select: none;
        position: relative;
    }

    body::before {
        content: '';
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: linear-gradient(to bottom, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.1) 100%);
        backdrop-filter: blur(8px);
        z-index: -1;
    }

    h1 {
        font-size: 2.5em;
        color: #333;
        margin-bottom: 20px;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    #game-container {
        background: rgba(255,255,255,0.8);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 30px;
        max-width: 90%;
        width: 800px;
        z-index: 1;
        position: relative;
        transition: all 0.3s ease-in-out;
        border-bottom: 5px solid rgba(166, 130, 227, 0.5);
    }

    #game-container:hover {
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        transform: translateY(-3px);
    }

    canvas {
        background: rgba(0,0,0,0.05);
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 10px;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
    }

    #controls {
        margin-top: 25px;
        text-align: center;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 15px;
    }

    #status {
        font-size: 1.2em;
        margin-top: 15px;
        font-weight: 600;
        color: #333;
        text-shadow: 0 1px 2px rgba(255,255,255,0.2);
    }

    #reset-button, #difficulty-select {
        padding: 12px 28px;
        font-size: 1em;
        color: #ffffff;
        background: linear-gradient(135deg, #a682e3 0%, #6a1b9a 100%);
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        transition: all 0.2s ease-in-out;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    #reset-button:hover, #difficulty-select:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0,0,0,0.25);
        opacity: 0.9;
    }

    #difficulty-select {
        padding: 12px 18px;
        background: rgba(255,255,255,0.7);
        color: #333;
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 50px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    #difficulty-select option {
        background-color: #f0f0f0;
        color: #333;
    }
</style>
</head>
<body>
<h1>Snake Game</h1>
<div id="game-container">
    <canvas id="gameCanvas" width="750" height="500"></canvas>
    <div id="controls">
        <button id="reset-button">Restart Game</button>
        <select id="difficulty-select">
            <option value="200">Easy</option>
            <option value="150" selected>Medium</option>
            <option value="100">Hard</option>
        </select>
    </div>
    <div id="status">Use Arrow Keys or WASD to start!</div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const resetButton = document.getElementById("reset-button");
const difficultySelect = document.getElementById("difficulty-select");
const statusDiv = document.getElementById("status");

const box = 25;
let snake, food, direction, score, game, foodBlinkInterval;
let foodVisible = true;

// Initialize game
function initGame() {
    const initialX = Math.floor(canvas.width / 2 / box) * box;
    const initialY = Math.floor(canvas.height / 2 / box) * box;
    snake = [{ x: initialX, y: initialY }];
    direction = null;
    score = 0;
    food = randomFood();
    statusDiv.textContent = "Use Arrow Keys or WASD to start!";
    if (game) clearInterval(game);
    if (foodBlinkInterval) clearInterval(foodBlinkInterval);
    draw();
}

// Generate random food
function randomFood() {
    let newFood;
    do {
        newFood = {
            x: Math.floor(Math.random() * (canvas.width / box)) * box,
            y: Math.floor(Math.random() * (canvas.height / box)) * box
        };
    } while (collision(newFood, snake));
    return newFood;
}

// Keyboard controls
document.addEventListener("keydown", (event) => {
    if (!game) startGame();

    if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(event.key)) {
        event.preventDefault();
    }

    if (event.key === "ArrowLeft" || event.key.toLowerCase() === "a") {
        if (direction !== "RIGHT") direction = "LEFT";
    } else if (event.key === "ArrowUp" || event.key.toLowerCase() === "w") {
        if (direction !== "DOWN") direction = "UP";
    } else if (event.key === "ArrowRight" || event.key.toLowerCase() === "d") {
        if (direction !== "LEFT") direction = "RIGHT";
    } else if (event.key === "ArrowDown" || event.key.toLowerCase() === "s") {
        if (direction !== "UP") direction = "DOWN";
    }
});

// Start the game loop
function startGame() {
    if (game) clearInterval(game);
    const gameSpeed = parseInt(difficultySelect.value); // Use the base difficulty value
    game = setInterval(draw, gameSpeed);
    foodBlinkInterval = setInterval(() => foodVisible = !foodVisible, 250);
    statusDiv.textContent = `Score: ${score}`;
}

// Draw everything
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw food
    if (foodVisible) {
        ctx.fillStyle = "#ff6b6b";
        ctx.beginPath();
        ctx.arc(food.x + box/2, food.y + box/2, box/2 - 2, 0, Math.PI * 2);
        ctx.fill();
    }

    // Move snake
    let snakeX = snake[0].x;
    let snakeY = snake[0].y;

    if (direction === "LEFT") snakeX -= box;
    if (direction === "UP") snakeY -= box;
    if (direction === "RIGHT") snakeX += box;
    if (direction === "DOWN") snakeY += box;

    // Eat food
    if (snakeX === food.x && snakeY === food.y) {
        score++;
        food = randomFood();
    } else {
        if (direction) {
            snake.pop();
        }
    }

    const newHead = { x: snakeX, y: snakeY };

    // Check collision
    if (direction && (
        snakeX < 0 || snakeY < 0 ||
        snakeX >= canvas.width || snakeY >= canvas.height ||
        collision(newHead, snake)
    )) {
        endGame();
        return;
    }

    if (direction) {
        snake.unshift(newHead);
        statusDiv.textContent = `Score: ${score}`;
    }

    // Draw snake
    for (let i = 0; i < snake.length; i++) {
        const head = i === 0;
        ctx.fillStyle = head ? "#6a1b9a" : "#a682e3";
        ctx.beginPath();
        ctx.arc(snake[i].x + box/2, snake[i].y + box/2, box/2 - 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,0.5)";
        ctx.stroke();

        // Draw eyes for the head
        if (head) {
            ctx.fillStyle = "#fff"; // White eyes
            // Draw left eye
            ctx.beginPath();
            ctx.arc(snake[i].x + box/4 + (direction === "RIGHT" ? box/8 : (direction === "LEFT" ? -box/8 : 0)), 
                    snake[i].y + box/4 + (direction === "DOWN" ? box/8 : (direction === "UP" ? -box/8 : 0)), 
                    3, 0, Math.PI * 2);
            ctx.fill();
            // Draw right eye
            ctx.beginPath();
            ctx.arc(snake[i].x + 3*box/4 + (direction === "RIGHT" ? box/8 : (direction === "LEFT" ? -box/8 : 0)), 
                    snake[i].y + box/4 + (direction === "DOWN" ? box/8 : (direction === "UP" ? -box/8 : 0)), 
                    3, 0, Math.PI * 2);
            ctx.fill();
        }
    }
}

function collision(head, array) {
    return array.some(segment => segment.x === head.x && segment.y === head.y);
}

function endGame() {
    clearInterval(game);
    clearInterval(foodBlinkInterval);
    game = null;
    foodBlinkInterval = null;
    statusDiv.textContent = `Game Over! Final Score: ${score}`;
}

resetButton.addEventListener("click", initGame);
difficultySelect.addEventListener("change", initGame);

initGame();
</script>
</body>
</html>